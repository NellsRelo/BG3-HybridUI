<ls:UIWidget x:Name="CharacterRespec_c"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ls="clr-namespace:ls;assembly=Code"
    xmlns:System="clr-namespace:System;assembly=mscorlib"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    mc:Ignorable="d"
    d:DesignHeight="2160" d:DesignWidth="3840"
    ls:UIWidget.ContextName="CharacterCreation"
    FocusDown="UIDown" FocusLeft="UILeft" FocusRight="UIRight" FocusUp="UIUp" ls:MoveFocus.FocusMovementMode="Closest" CanCacheFocusSurroundingElements="False">

    <ls:UIWidget.Resources>
        <ResourceDictionary>

            <ControlTemplate x:Key="skillsSelectionTemplate">
                <DockPanel Height="{StaticResource gameplayPanelHeight}">
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="Loaded">
                            <ls:SetMoveFocusAction TargetName="CharacterRespec_c"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>

                    <TextBlock DockPanel.Dock="Bottom" Visibility="{Binding IsEnabled, ElementName=nextTabButton, Converter={StaticResource BoolToCollapsedConverter}}" ls:TextBlockFormatter.SourceText="{Binding Source='h99d22567g8b26g4d70gbe0dgb275f4968652', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource gameplayPanelContinueTextStyle}"/>

                    <StackPanel DockPanel.Dock="Top">
                        <Control Template="{StaticResource setOverviewCamera}"/>

                        <Control Template="{DynamicResource skillsSelectionHeader}"/>
                        <Control Template="{DynamicResource skillsSelectionDescription}"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,30,0,0">
                            <Control Template="{DynamicResource skillsSelectedLabel}"/>
                            <TextBlock x:Name="AssignedValue" FontSize="{StaticResource ScaledDefaultFontSize}" HorizontalAlignment="Center" Margin="20,0,0,0">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0}/{1}">
                                        <Binding Path="SelectedSkillCount"/>
                                        <Binding Path="MaxSelectedSkillCount"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                            <StackPanel.Resources>
                                <Style TargetType="Image">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Setter Property="Stretch" Value="None"/>
                                    <Setter Property="Width" Value="48"/>
                                    <Setter Property="Height" Value="48"/>
                                </Style>
                            </StackPanel.Resources>
                            <Image x:Name="point0" Source="{StaticResource tabDotOff}"/>
                            <Image x:Name="point1" Source="{StaticResource tabDotOff}"/>
                            <Image x:Name="point2" Source="{StaticResource tabDotOff}"/>
                            <Image x:Name="point3" Source="{StaticResource tabDotOff}"/>
                        </StackPanel>

                    </StackPanel>

                    <ScrollViewer Style="{StaticResource gameplayPanelScrollViewerStyle}">
                        <StackPanel Style="{StaticResource gameplayScrolledStackPanelStyle}">

                            <Control Template="{DynamicResource selectableSkills}"/>

                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>

                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                        <Setter TargetName="point0" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=1}" Value="True">
                        <Setter TargetName="point1" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=2}" Value="True">
                        <Setter TargetName="point2" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=3}" Value="True">
                        <Setter TargetName="point3" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding SelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                        <Setter TargetName="point0" Property="Source" Value="{StaticResource tabDotOn}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=1}" Value="True">
                        <Setter TargetName="point1" Property="Source" Value="{StaticResource tabDotOn}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=2}" Value="True">
                        <Setter TargetName="point2" Property="Source" Value="{StaticResource tabDotOn}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=3}" Value="True">
                        <Setter TargetName="point3" Property="Source" Value="{StaticResource tabDotOn}"/>
                    </DataTrigger>

                    <DataTrigger Value="False">
                        <DataTrigger.Binding>
                            <MultiBinding Converter="{StaticResource EqualConverter}">
                                <Binding Path="SelectedSkillCount"/>
                                <Binding Path="MaxSelectedSkillCount"/>
                            </MultiBinding>
                        </DataTrigger.Binding>
                        <Setter TargetName="AssignedValue" Property="Foreground" Value="{StaticResource CCTabToDo}"/>
                    </DataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <ControlTemplate x:Key="RespecBottomButtonsTemplate">
                <StackPanel Orientation="Horizontal">
                    <!-- Toggle tooltips -->
                    <ls:LSButton x:Name="ToggleTooltips" Margin="50,0,0,0"
                                 Command="ls:UIWidget.ToggleTooltipOnUIElementCommand"
                                 CommandParameter="{Binding FocusedElement, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ls:UIWidget}}"
                                 BoundEvent="UIShowInfo"
                                 ContentTemplate="{StaticResource ControllerButtonHint}"
                                 Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UIShowInfo, Converter={StaticResource FindInputEventConverter}}"
                                 Tag="{Binding Source='hf8dd4c2fg97e0g4ccdgac1ag3cd1fe5060ef', Converter={StaticResource TranslatedStringConverter}}" TapTime="{StaticResource DefaultButtonTapTime}"/>

                    <ls:LSButton x:Name="showSummary" Visibility="{Binding ElementName=summary, Path=Visibility, Converter={StaticResource InvertVisibilityConverter}}"
                                 ContentTemplate="{StaticResource ControllerButtonHint}" Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UISort, Converter={StaticResource FindInputEventConverter}}"
                                 BoundEvent="UISort" Tag="{Binding Source=h890f4cddg2bdcg4bb2gb73eg43fe16b11b08,Converter={StaticResource TranslatedStringConverter}}" EatInput="False" TapTime="{StaticResource DefaultButtonTapTime}">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="summary" PropertyName="Visibility" Value="Visible"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>
                    <ls:LSButton x:Name="hideSummary" Visibility="{Binding ElementName=summary, Path=Visibility}" ContentTemplate="{StaticResource ControllerButtonHint}"
                                 Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UISort, Converter={StaticResource FindInputEventConverter}}"
                                 BoundEvent="UISort" Tag="{Binding Source=h70ec62ddg0cfcg4512ga0c6gbc591945b75b,Converter={StaticResource TranslatedStringConverter}}" EatInput="False" TapTime="{StaticResource DefaultButtonTapTime}">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="summary" PropertyName="Visibility" Value="Collapsed"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>

                    <ls:LSButton x:Name="backButton" Style="{StaticResource ControllerHoldButtonStyle}" Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UICancel, Converter={StaticResource FindInputEventConverter}}"
                                 BoundEvent="UICancel" EatInput="False" Tag="{Binding Source=h77fec760g866dg4e47g8e81g467c9c05e447,Converter={StaticResource TranslatedStringConverter}}" Margin="50,0,0,0"
                                 Command="{Binding DataContext.ExitCharacterRespec, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                    </ls:LSButton>
                    
                    <ls:LSInputBinding x:Name="PinTooltipBinding" Style="{StaticResource PinTooltipBindingStyle}"/>
                </StackPanel>
                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding ShowUIElementTooltip, ElementName=CharacterRespec_c}" Value="True">
                        <Setter TargetName="ToggleTooltips" Property="Tag" Value="{Binding Source='hb33ec471gd611g4ee3gbbffg699af8f79167', Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="draconic">
                        <Setter TargetName="ToggleTooltips" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <ControlTemplate x:Key="confirmButtonTemplate" TargetType="Button">
                <ls:LSNineSliceImage x:Name="bg" ImageSource="pack://application:,,,/Core;component/Assets/CC_c/c_cc_primaryButtonBG.png" Slices="84,84,84,84" MinWidth="168" MinHeight="172">
                    <StackPanel x:Name="contents" Orientation="Horizontal" VerticalAlignment="Center">
                        <Control x:Name="img" DataContext="{Binding CurrentPlayer.UIData.InputEvents, Converter={StaticResource FindInputEventConverter}, ConverterParameter='UIDelete'}"
                                 Template="{StaticResource ControllerButton.ImageSwitcher}" Width="{DynamicResource ScaledControllerHintSize}" Height="{DynamicResource ScaledControllerHintSize}"
                                 Focusable="False" VerticalAlignment="Center" Margin="26,0,-10,0"/>

                        <TextBlock x:Name="text" ls:TextBlockFormatter.SourceText="{Binding Source='h7a174735g0099g4ca9ga1f7ga53ad66b1aa4', Converter={StaticResource TranslatedStringConverter}}" FontSize="{StaticResource ScaledMediumFontSize}"
                                   VerticalAlignment="Center" Margin="0,0,60,0"/>
                    </StackPanel>
                </ls:LSNineSliceImage>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter TargetName="bg" Property="ImageSource" Value="pack://application:,,,/Core;component/Assets/CC_c/c_cc_primaryButtonBG_disabled.png"/>
                        <Setter TargetName="contents" Property="Opacity" Value="{StaticResource DisabledOpacity}"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style x:Key="confirmRespecButtonStyle" TargetType="ls:LSButton">
                <Setter Property="Template" Value="{StaticResource confirmButtonTemplate}"/>
                <Setter Property="BoundEvent" Value="UIDelete"/>
                <Setter Property="Command" Value="{Binding DataContext.FinishCreating, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
            </Style>
        </ResourceDictionary>
    </ls:UIWidget.Resources>


    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <!-- Start with Tooltips enabled -->
            <b:InvokeCommandAction Command="{Binding EnableTooltipOnUIElementCommand, ElementName=CharacterRespec_c}"/>
            <b:InvokeCommandAction Command="{Binding SetCharacterCreationStep}" CommandParameter="Class"/>
        </b:EventTrigger>

        <b:EventTrigger EventName="GotKeyboardFocus">
            <b:InvokeCommandAction Command="{Binding ShowTooltipOnUIElementCommand, ElementName=CharacterRespec_c}" CommandParameter="{Binding Path=FocusedElement, ElementName=CharacterRespec_c}"/>
        </b:EventTrigger>
        <b:DataTrigger Binding="{Binding HasInputEnabled, ElementName=CharacterRespec_c}" Value="True">
            <b:InvokeCommandAction Command="{Binding ShowTooltipOnUIElementCommand, ElementName=CharacterRespec_c}" CommandParameter="{Binding FocusedElement, ElementName=CharacterRespec_c}"/>
        </b:DataTrigger>

        <b:EventTrigger EventName="MoveFocusUp">
            <ls:LSPlaySound Sound="UI_Shared_Hover" />
        </b:EventTrigger>

        <b:EventTrigger EventName="MoveFocusDown">
            <ls:LSPlaySound Sound="UI_Shared_Hover" />
        </b:EventTrigger>

        <b:EventTrigger EventName="MoveFocusRight">
            <ls:LSPlaySound Sound="UI_Shared_Hover" />
        </b:EventTrigger>

        <b:EventTrigger EventName="MoveFocusLeft">
            <ls:LSPlaySound Sound="UI_Shared_Hover" />
        </b:EventTrigger>
    </b:Interaction.Triggers>

    <b:Interaction.Behaviors>
        <ls:CollectionFilterBehavior x:Name="RaceProgressions" ItemsSource="{Binding RaceProgressionDetails.Progressions}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubRaceProgressions" ItemsSource="{Binding RaceProgressionDetails.Progressions}" Predicate="{Binding IsSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="ClassProgressions" ItemsSource="{Binding ClassProgressionDetails.Progressions}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubClassProgressions" ItemsSource="{Binding ClassProgressionDetails.Progressions}" Predicate="{Binding IsSubProgressionPredicate}"/>

        <ls:CollectionFilterBehavior x:Name="RaceSpellSelectors" ItemsSource="{Binding RaceProgressionDetails.SpellSelectors}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubRaceSpellSelectors" ItemsSource="{Binding RaceProgressionDetails.SpellSelectors}" Predicate="{Binding IsSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="ClassSpellSelectors" ItemsSource="{Binding ClassProgressionDetails.SpellSelectors}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubClassSpellSelectors" ItemsSource="{Binding ClassProgressionDetails.SpellSelectors}" Predicate="{Binding IsSubProgressionPredicate}"/>

        <ls:CollectionFilterBehavior x:Name="RacePassiveFeatures" ItemsSource="{Binding RacePassiveFeatures}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubRacePassiveFeatures" ItemsSource="{Binding RacePassiveFeatures}" Predicate="{Binding IsSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="RacePassiveSelectors" ItemsSource="{Binding RaceProgressionDetails.NotSubPassiveSelectors}"/>
        <ls:CollectionFilterBehavior x:Name="SubRacePassiveSelectors" ItemsSource="{Binding RaceProgressionDetails.SubPassiveSelectors}"/>
        <ls:CollectionFilterBehavior x:Name="ClassPassiveFeatures" ItemsSource="{Binding PassiveFeatures}" Predicate="{Binding IsNotSubProgressionPredicate}"/>
        <ls:CollectionFilterBehavior x:Name="SubClassPassiveFeatures" ItemsSource="{Binding PassiveFeatures}" Predicate="{Binding IsSubProgressionPredicate}"/>

        <ls:CollectionSortBehavior x:Name="SortedRaceSkills" ItemsSource="{Binding AllSkills.RaceProficientSkills.Skills}" Comparer="{Binding SkillSortComparer}" />
        <ls:CollectionSortBehavior x:Name="SortedClassSkills" ItemsSource="{Binding AllSkills.ClassProficientSkills.Skills}" Comparer="{Binding SkillSortComparer}" />
        <ls:CollectionSortBehavior x:Name="SortedExpertiseSkills" ItemsSource="{Binding AllSkills.ExpertiseSkills.Skills}" Comparer="{Binding SkillSortComparer}" />

        <ls:CollectionSortBehavior x:Name="SortedSummarySkills" ItemsSource="{Binding ProgressionData.AllProgressions.Skills}" Comparer="{Binding SkillSortComparer}" />
        <ls:CollectionSortBehavior x:Name="SortedPreparableSpells" ItemsSource="{Binding SpellPrepare.Preparable}" Comparer="{Binding SpellByLevelSortComparer}" />
        <ls:CollectionSortBehavior x:Name="SortedPreparableSpellGroupsByLevel" ItemsSource="{Binding SpellPrepare.PreparableByLevel}" Comparer="{Binding SpellGroupByLevelSortComparer}" />

    </b:Interaction.Behaviors>

    <Grid ls:TooltipExtender.Owner="{Binding DummyCharacter}" IsEnabled="{Binding IsLocked, Converter={StaticResource InvertBoolConverter}}">

        <Control Template="{StaticResource setOverviewCamera}"/>

        <Control x:Name="gamePlayPage">
            <Control.Template>
                <ControlTemplate TargetType="Control">
                    <Grid>
                        <Grid>
                            <Rectangle x:Name="bottomShading" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Height="{StaticResource bottomBackgroundHeight}" Fill="{StaticResource BottomShadingBrush}"/>
                            <Rectangle x:Name="leftSideShading" HorizontalAlignment="Left" Width="{StaticResource leftSidePanelBackgroundWidth}" Fill="{StaticResource LeftSideShadingBrush}" OpacityMask="{StaticResource OpacityMaskShadingBrush}"/>

                                <!-- FocusScope for returning from Summary -->
                            <Grid x:Name="leftSidePanels" ls:MoveFocus.IsMoveFocusScope="True" MinWidth="1218" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0,140,0,0">

                                <ContentControl x:Name="gameplaySubPanel" Content="{Binding .}">
                                    <b:Interaction.Triggers>
                                        <b:PropertyChangedTrigger Binding="{Binding Path=SelectedIndex, ElementName=gameplayTabs}">
                                            <b:Interaction.Behaviors>
                                                <b:ConditionBehavior>
                                                    <b:ConditionalExpression>
                                                        <b:ComparisonCondition LeftOperand="{Binding Path=SelectedIndex, ElementName=gameplayTabs}" Operator="NotEqual" RightOperand="-1"/>
                                                    </b:ConditionalExpression>
                                                </b:ConditionBehavior>
                                            </b:Interaction.Behaviors>
                                            <!-- clear subtab panel -->
                                            <b:ChangePropertyAction TargetName="gameplaySubPanel" PropertyName="DataContext" Value="{x:Null}"/>
                                        </b:PropertyChangedTrigger>
                                    </b:Interaction.Triggers>
                                </ContentControl>

                                <Control x:Name="gameplayPanel" Height="{StaticResource gameplayPanelHeightSplit}"/>
                            </Grid>

                            <Control x:Name="namingBackground"/>

                            <!-- Tab Bar Background -->
                            <Rectangle x:Name="tabBarBackground" Width="3000" Height="{StaticResource TabsPanelHeight}" Fill="{StaticResource NavShadingBrush}" HorizontalAlignment="Left" VerticalAlignment="Top"/>

                            <StackPanel x:Name="tabBar" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="216,0,0,0" Width="3000">

                                <Grid x:Name="tabBarClipper" Width="3000" ClipToBounds="True" Tag="430">
                                    <!-- All the Gameplay Tabs -->
                                    <ListBox x:Name="gameplayTabs" VerticalAlignment="Center" SelectedIndex="0">
                                        <ListBox.Template>
                                            <ControlTemplate TargetType="ListBox">
                                                <Grid x:Name="templateRoot">
                                                    <b:Interaction.Behaviors>
                                                        <ls:SubListBoxBehavior x:Name="SubListBoxHelper" RootListBox="{Binding RelativeSource={RelativeSource TemplatedParent}}" DoPrevious="{Binding ElementName=prevTabButton, Path=IsPressed}" DoNext="{Binding ElementName=nextTabButton, Path=IsPressed}"/>
                                                    </b:Interaction.Behaviors>

                                                    <!-- No ScrollViewer -->
                                                    <Grid x:Name="backplate" Width="{Binding ElementName=SubListBoxHelper, Path=BackplateWidth}" MinWidth="{Binding ElementName=SubListBoxHelper, Path=RootListBox.SelectedItem.ActualWidth}"
                                                          Height="{StaticResource TabsPanelHeight}" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Hidden">
                                                        <Grid.Tag>
                                                            <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                                                <!-- Tab Offset -->
                                                                <Binding ElementName="SubListBoxHelper" Path="SelectedOffset" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                                                                <Binding ElementName="tabSelector" Path="Width" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-0.5"/>
                                                                <Binding ElementName="tabBarClipper" Path="Tag"/>
                                                                <!-- Add backplate offset -->
                                                                <Binding ElementName="SubListBoxHelper" Path="BackplateOffset"/>
                                                            </MultiBinding>
                                                        </Grid.Tag>

                                                        <Grid.Background>
                                                            <LinearGradientBrush Opacity="1.0" StartPoint="0,0" EndPoint="0,1">
                                                                <GradientStop Offset="0" Color="{StaticResource transparentBlack}"/>
                                                                <GradientStop Offset="0.5" Color="#70af8768"/>
                                                                <GradientStop Offset="1.0" Color="#b0af8768" />
                                                            </LinearGradientBrush>
                                                        </Grid.Background>

                                                        <Grid.RenderTransform>
                                                            <TranslateTransform X="{Binding ElementName=backplate,Path=Tag}" Y="0"/>
                                                        </Grid.RenderTransform>

                                                        <Grid.Resources>
                                                            <Storyboard x:Key="SlideBackplateAnimation">
                                                                <DoubleAnimation Storyboard.TargetName="backplate" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="{StaticResource BackplateSlideAnimationDuration}"
                                                                    AccelerationRatio="0.25" DecelerationRatio="0.25" To="{Binding ElementName=backplate,Path=Tag}" FillBehavior="HoldEnd"/>
                                                            </Storyboard>
                                                        </Grid.Resources>

                                                        <b:Interaction.Triggers>
                                                            <b:PropertyChangedTrigger Binding="{Binding Path=SelectedOffset, ElementName=SubListBoxHelper}">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource SlideBackplateAnimation}"/>
                                                                <ls:LSControlStoryboard ControlStoryboardOption="Play" >
                                                                    <ls:LSControlStoryboard.Storyboard>
                                                                        <Storyboard x:Name="initialBackplateWidthSetting" Duration="0:0:0.1">
                                                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility" Storyboard.TargetName="backplate">
                                                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.1" Value="{x:Static Visibility.Visible}"/>
                                                                            </ObjectAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </ls:LSControlStoryboard.Storyboard>
                                                                </ls:LSControlStoryboard>
                                                            </b:PropertyChangedTrigger>
                                                            <b:StoryboardCompletedTrigger Storyboard="{StaticResource SlideBackplateAnimation}">
                                                                <b:Interaction.Behaviors>
                                                                    <b:ConditionBehavior>
                                                                        <b:ConditionalExpression>
                                                                            <b:ComparisonCondition LeftOperand="{Binding ElementName=backplate, Path=(UIElement.RenderTransform).(TranslateTransform.X)}" Operator="NotEqual" RightOperand="{Binding ElementName=backplate, Path=Tag}"/>
                                                                        </b:ConditionalExpression>
                                                                    </b:ConditionBehavior>
                                                                </b:Interaction.Behaviors>
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource SlideBackplateAnimation}"/>
                                                            </b:StoryboardCompletedTrigger>
                                                            <b:PropertyChangedTrigger Binding="{Binding Path=Tag, ElementName=tabBarClipper}">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play">
                                                                    <b:ControlStoryboardAction.Storyboard>
                                                                        <Storyboard x:Name="slideBackplateSplitscreen">
                                                                            <DoubleAnimation Storyboard.TargetName="backplate" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="{StaticResource BackplateSlideAnimationDuration}"
                                                                                             AccelerationRatio="0.25" DecelerationRatio="0.25" To="{Binding ElementName=backplate,Path=Tag}" FillBehavior="Stop"/>
                                                                        </Storyboard>
                                                                    </b:ControlStoryboardAction.Storyboard>
                                                                </b:ControlStoryboardAction>
                                                            </b:PropertyChangedTrigger>
                                                            <b:TimerTrigger EventName="Loaded" SourceName="tabBarButtons" MillisecondsPerTick="280" TotalTicks="1">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play">
                                                                    <b:ControlStoryboardAction.Storyboard>
                                                                        <Storyboard >
                                                                            <DoubleAnimation Storyboard.TargetName="backplate" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="0:0:0.02" From="300"
                                                                                             To="{Binding ElementName=backplate,Path=Tag}" FillBehavior="Stop"/>
                                                                        </Storyboard>
                                                                    </b:ControlStoryboardAction.Storyboard>
                                                                </b:ControlStoryboardAction>
                                                            </b:TimerTrigger>

                                                        </b:Interaction.Triggers>
                                                    </Grid>

                                                    <Grid x:Name="itemsPanel">
                                                        <Grid.Tag>
                                                            <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                                                <Binding ElementName="SubListBoxHelper" Path="SelectedOffset" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                                                                <Binding ElementName="tabSelector" Path="Width" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-0.5"/>
                                                                <Binding ElementName="tabBarClipper" Path="Tag"/>
                                                            </MultiBinding>
                                                        </Grid.Tag>

                                                        <Grid.RenderTransform>
                                                            <TranslateTransform X="{Binding ElementName=itemsPanel,Path=Tag}" Y="0"/>
                                                        </Grid.RenderTransform>

                                                        <Grid.Resources>
                                                            <Storyboard x:Key="ScrollTabsAnimation">
                                                                <DoubleAnimation Storyboard.TargetName="itemsPanel" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="{StaticResource TabsSlideAnimationDuration}"
                                                                    AccelerationRatio="0.25" DecelerationRatio="0.25" To="{Binding ElementName=itemsPanel,Path=Tag}" FillBehavior="HoldEnd"/>
                                                            </Storyboard>
                                                        </Grid.Resources>

                                                        <b:Interaction.Triggers>
                                                            <b:PropertyChangedTrigger Binding="{Binding Path=SelectedOffset, ElementName=SubListBoxHelper}">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource ScrollTabsAnimation}"/>
                                                            </b:PropertyChangedTrigger>
                                                            <b:StoryboardCompletedTrigger Storyboard="{StaticResource ScrollTabsAnimation}">
                                                                <b:Interaction.Behaviors>
                                                                    <b:ConditionBehavior>
                                                                        <b:ConditionalExpression>
                                                                            <b:ComparisonCondition LeftOperand="{Binding ElementName=itemsPanel, Path=(UIElement.RenderTransform).(TranslateTransform.X)}" Operator="NotEqual" RightOperand="{Binding ElementName=itemsPanel, Path=Tag}"/>
                                                                        </b:ConditionalExpression>
                                                                    </b:ConditionBehavior>
                                                                </b:Interaction.Behaviors>
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource ScrollTabsAnimation}"/>
                                                            </b:StoryboardCompletedTrigger>
                                                            <b:PropertyChangedTrigger Binding="{Binding Path=Tag, ElementName=tabBarClipper}">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play">
                                                                    <b:ControlStoryboardAction.Storyboard>
                                                                        <Storyboard x:Name="scrollTabsSplitscreen">
                                                                            <DoubleAnimation Storyboard.TargetName="itemsPanel" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="{StaticResource TabsSlideAnimationDuration}"
                                                                                             AccelerationRatio="0.25" DecelerationRatio="0.25" To="{Binding ElementName=itemsPanel,Path=Tag}" FillBehavior="Stop"/>
                                                                        </Storyboard>
                                                                    </b:ControlStoryboardAction.Storyboard>
                                                                </b:ControlStoryboardAction>
                                                            </b:PropertyChangedTrigger>
                                                            <b:TimerTrigger EventName="Loaded" SourceName="tabBarButtons" MillisecondsPerTick="280" TotalTicks="1">
                                                                <b:ControlStoryboardAction ControlStoryboardOption="Play">
                                                                    <b:ControlStoryboardAction.Storyboard>
                                                                        <Storyboard >
                                                                            <DoubleAnimation Storyboard.TargetName="itemsPanel" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" Duration="0:0:0.02" From="300"
                                                                                             To="{Binding ElementName=itemsPanel,Path=Tag}" FillBehavior="Stop"/>
                                                                        </Storyboard>
                                                                    </b:ControlStoryboardAction.Storyboard>
                                                                </b:ControlStoryboardAction>
                                                            </b:TimerTrigger>

                                                        </b:Interaction.Triggers>
                                                        <ItemsPresenter/>

                                                    </Grid>

                                                </Grid>
                                                <ControlTemplate.Triggers>
                                                    <!-- Animated Tabs Backplate Width matching -->
                                                    <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="race">
                                                        <Setter TargetName="backplate" Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                                                    <Binding Path="ActualWidth" ElementName="raceTab"/>
                                                                    <Binding Path="ActualWidth" ElementName="subRaceTab"/>
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="subrace">
                                                        <Setter TargetName="backplate" Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                                                    <Binding Path="ActualWidth" ElementName="raceTab"/>
                                                                    <Binding Path="ActualWidth" ElementName="subRaceTab"/>
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="class">
                                                        <Setter TargetName="backplate" Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                                                    <Binding Path="ActualWidth" ElementName="classTab"/>
                                                                    <Binding Path="ActualWidth" ElementName="subClassTab"/>
                                                                    <Binding Path="ActualWidth" ElementName="deityTab"/>
                                                                    <Binding Path="ActualWidth" ElementName="spellPrepTab"/>
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ListBox.Template>

                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel IsItemsHost="True" Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>

                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Template" Value="{StaticResource gameplayTabTemplate2}"/>
                                            </Style>
                                        </ListBox.ItemContainerStyle>

                                        <ListBoxItem x:Name="raceTab" Tag="race" IsSelected="True"/>
                                        <ListBoxItem x:Name="subRaceTab" Tag="subrace" IsEnabled="{Binding SelectableSubRaces.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>

                                        <ListBoxItem x:Name="classTab" Tag="class"/>
                                        <ListBoxItem x:Name="subClassTab" Tag="subclass" IsEnabled="{Binding SelectableSubClasses.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="deityTab" Tag="deity" IsEnabled="{Binding SelectableDeities.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="spellPrepTab" Tag="spellprep" IsEnabled="{Binding SpellPrepare.Preparable.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="draconicTab" Tag="draconic" Visibility="Collapsed"/>

                                        <ListBoxItem x:Name="backgroundTab" Tag="background"/>
                                        <ListBoxItem x:Name="featTab" Tag="feats" IsEnabled="{Binding SelectableFeats.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="featDetailsTab" Tag="featdetails" Visibility="{Binding SelectedFeatDetails.HasFeat, Converter={StaticResource BoolToVisibleConverter}}"/>
                                        <ListBoxItem x:Name="raceSkillsTab" Tag="raceskills" IsEnabled="{Binding AllSkills.RaceProficientSkills.MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="skillsTab" Tag="skills" IsEnabled="{Binding AllSkills.ClassProficientSkills.MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="expertiseTab" Tag="expertise" IsEnabled="{Binding AllSkills.ExpertiseSkills.MaxSelectedSkillCount, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}"/>
                                        <ListBoxItem x:Name="abilityTab" Tag="ability"/>

                                    </ListBox>

                                    <!-- Gameplay tab selector underlines -->
                                    <Grid x:Name="selectedTabUnderline" HorizontalAlignment="Left" Margin="102,88,0,0" Width="600" Visibility="Visible">
                                        <ls:LSNineSliceImage x:Name="tabSelector" Style="{StaticResource tabSelectorStyle}" Width="0" Margin="0,0,0,0"/>
                                    </Grid>

                                </Grid>

                            </StackPanel>

                            <!-- Tab Navigation Buttons -->
                            <StackPanel x:Name="tabBarButtons" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="50,0,0,0">
                                <ls:LSButton x:Name="prevTabButton" 
                                             IsEnabled="{Binding ElementName=SubListBoxHelper,Path=HasPrevious}"
                                             ContentTemplate="{StaticResource ControllerButtonHintImageOnly}"
                                             Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UITabPrev, Converter={StaticResource FindInputEventConverter}}"
                                             BoundEvent="UITabPrev"
                                             Margin="-20,0,-20,0"/>
                                <ls:LSButton x:Name="nextTabButton" 
                                             IsEnabled="{Binding ElementName=SubListBoxHelper,Path=HasNext}"
                                             ContentTemplate="{StaticResource ControllerButtonHintImageOnly}"
                                             Content="{Binding CurrentPlayer.UIData.InputEvents, ConverterParameter=UITabNext, Converter={StaticResource FindInputEventConverter}}"
                                             BoundEvent="UITabNext"
                                             Margin="-20,0,-20,0"/>
                            </StackPanel>

                            <ContentPresenter x:Name="MissingRequirementsError" HorizontalAlignment="Center" VerticalAlignment="Bottom" Visibility="Collapsed" Margin="0,0,0,200" ContentTemplate="{StaticResource MissingRequirementsErrorTemplate}" Content=""/>

                        </Grid>

                        <Grid x:Name="summary" Visibility="Visible" HorizontalAlignment="Right">
                            <Rectangle x:Name="summaryBackground" HorizontalAlignment="Right" Width="{StaticResource summaryPanelBackgroundWidth}" RenderTransformOrigin="1,0.5" Fill="{StaticResource RightSideShadingBrush}" OpacityMask="{StaticResource OpacityMaskShadingBrush}">
                                <Rectangle.RenderTransform>
                                    <ScaleTransform/>
                                </Rectangle.RenderTransform>
                            </Rectangle>

                            <Grid x:Name="summaryAnimPanel" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,230,34,0">
                                <Grid.RenderTransform>
                                    <TranslateTransform X="0"/>
                                </Grid.RenderTransform>

                                <Control x:Name="summaryPanel" IsEnabled="False" ls:MoveFocus.IsMoveFocusScope="True" Template="{StaticResource summaryPanelTemplate}"  HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,70,16,0"/>

                                <ls:LSInputBinding x:Name="backFromFocusedSummary" IsEnabled="{Binding IsEnabled, ElementName=summaryPanel}" BoundEvent="UICancel">
                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="LSInputBindingReleased" >
                                            <b:ChangePropertyAction TargetName="leftSidePanels" PropertyName="IsEnabled" Value="True" />
                                            <b:ChangePropertyAction TargetName="summaryPanel" PropertyName="IsEnabled" Value="False" />
                                            <b:ChangePropertyAction TargetName="focusSummaryPanelButton" PropertyName="Visibility" Value="Visible" />
                                            <b:ChangePropertyAction TargetName="focusGameplayPanelButton" PropertyName="Visibility" Value="Hidden" />
                                            <ls:SetMoveFocusAction TargetName="CharacterRespec_c" FocusElement="{Binding ElementName=leftSidePanels}"/>
                                            <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource unfocusSummaryPanelStoryboard}"/>
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>                                    
                                </ls:LSInputBinding>

                                <ls:LSButton x:Name="focusGameplayPanelButton"
                                             Visibility="Hidden" 
                                             Tag=" " 
                                             ContentTemplate="{StaticResource ControllerButtonHint}"
                                             Content="{Binding CurrentPlayer.UIData.InputEvents, Converter={StaticResource FindInputEventConverter}, ConverterParameter='JumpToFromTab'}"
                                             BoundEvent="JumpToFromTab"
                                             HorizontalAlignment="Left"
                                             VerticalAlignment="Top"
                                             Margin="50,230,0,0">
                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="Click" >
                                            <b:ChangePropertyAction TargetName="leftSidePanels" PropertyName="IsEnabled" Value="True" />
                                            <b:ChangePropertyAction TargetName="summaryPanel" PropertyName="IsEnabled" Value="False" />
                                            <b:ChangePropertyAction TargetName="focusSummaryPanelButton" PropertyName="Visibility" Value="Visible" />
                                            <b:ChangePropertyAction TargetName="focusGameplayPanelButton" PropertyName="Visibility" Value="Hidden" />
                                            <ls:SetMoveFocusAction TargetName="CharacterRespec_c" FocusElement="{Binding ElementName=leftSidePanels}"/>
                                            <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource unfocusSummaryPanelStoryboard}"/>
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>
                                </ls:LSButton>

                                <ls:LSButton x:Name="focusSummaryPanelButton"
                                             Tag=" " 
                                             ContentTemplate="{StaticResource ControllerButtonHint}"
                                             Content="{Binding CurrentPlayer.UIData.InputEvents, Converter={StaticResource FindInputEventConverter}, ConverterParameter='ToggleSummaryFocus'}"
                                             BoundEvent="ToggleSummaryFocus"
                                             HorizontalAlignment="Right"
                                             VerticalAlignment="Top">
                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="Click" >
                                            <b:ChangePropertyAction TargetName="leftSidePanels" PropertyName="IsEnabled" Value="False" />
                                            <b:ChangePropertyAction TargetName="summaryPanel" PropertyName="IsEnabled" Value="True" />
                                            <b:ChangePropertyAction TargetName="focusSummaryPanelButton" PropertyName="Visibility" Value="Hidden" />
                                            <b:ChangePropertyAction TargetName="focusGameplayPanelButton" PropertyName="Visibility" Value="Visible" />
                                            <ls:SetMoveFocusAction TargetName="CharacterRespec_c" FocusElement="{Binding ElementName=summaryPanel}"/>
                                            <b:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource focusSummaryPanelStoryboard}"/>
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>
                                </ls:LSButton>

                            </Grid>
                        </Grid>

                        <ContentControl Template="{StaticResource buttonBackplateTemplate}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,148">
                            <ls:LSButton x:Name="confirmButton" Style="{StaticResource ControllerHoldButtonStyle}" Content="{Binding CurrentPlayer.UIData.InputEvents, Converter={StaticResource FindInputEventConverter}, ConverterParameter='UIDelete'}" Tag="{Binding Source='h7a174735g0099g4ca9ga1f7ga53ad66b1aa4', Converter={StaticResource TranslatedStringConverter}}" Command="{Binding DataContext.FinishCreating, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Margin="2,0,0,0"/>
                        </ContentControl>

                        <StackPanel Style="{StaticResource ButtonHint.Container.Right}">
                            <Control x:Name="bottomButtons" Template="{StaticResource RespecBottomButtonsTemplate}"/>
                        </StackPanel>

                    </Grid>

                    <ControlTemplate.Triggers>
                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="ability">
                            <Setter TargetName="nextTabButton" Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>

                        <!-- Split Screen variation -->
                        <DataTrigger Binding="{Binding Layout}" Value="Common">
                            <Setter TargetName="leftSidePanels" Property="Margin" Value="170,140,0,0"/>
                            <Setter TargetName="gameplayPanel" Property="Height" Value="{StaticResource gameplayPanelHeight}"/>
                            <Setter TargetName="tabBarClipper" Property="Tag" Value="580"/>
                            <Setter TargetName="tabBar" Property="Margin" Value="226,0,0,0"/>
                            <Setter TargetName="selectedTabUnderline" Property="Margin" Value="252,88,0,0"/>
                        </DataTrigger>

                        <!-- Default (non-splitscreen) mode -->
                        <DataTrigger Binding="{Binding Layout}" Value="Left">
                        </DataTrigger>
                        
                        <DataTrigger Binding="{Binding Layout}" Value="Right">
                        </DataTrigger>

                        <!-- Disabled next/continue button if current subtab panel is incomplete -->
                        <DataTrigger Binding="{Binding DataContext.IsComplete, ElementName=gameplaySubPanel}" Value="False">
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="ability"/>
                                <Condition Binding="{Binding UnusedAbilityPoints, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </MultiDataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="ability"/>
                                <Condition Binding="{Binding Validity.RacialSelectors.AbilityBonusSelectors}" Value="False"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </MultiDataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="skills"/>
                                <Condition Binding="{Binding Validity.ClassSelectors.SkillProficiencySelectors}" Value="False"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </MultiDataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="expertise"/>
                                <Condition Binding="{Binding Validity.ClassSelectors.SkillExpertiseSelectors}" Value="False"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </MultiDataTrigger>

                        <DataTrigger Binding="{Binding IsEnabled, ElementName=leftSidePanels}" Value="False">
                            <Setter TargetName="nextTabButton" Property="IsEnabled" Value="False"/>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsEnabled, ElementName=nextTabButton}" Value="False"/>
                                <Condition Binding="{Binding Visibility, ElementName=nextTabButton}" Value="Visible"/>
                                <Condition Binding="{Binding IsEnabled, ElementName=leftSidePanels}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="MissingRequirementsError" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger>

                        <!--
                        Gameplay Panel Content 
                        -->

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="race">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource RaceSelectorTemplate}"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="subrace">
                            <Setter TargetName="gameplayPanel" Property="Template">
                                <Setter.Value>
                                    <ControlTemplate>
                                      <DockPanel LastChildFill="True">
                                        <Grid>
                                          <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                          </Grid.RowDefinitions>
                                            <b:Interaction.Triggers>
                                                <b:EventTrigger EventName="Loaded">
                                                    <ls:SetMoveFocusAction TargetName="CharacterRespec_c"/>
                                                </b:EventTrigger>
                                            </b:Interaction.Triggers>

                                            <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                            <StackPanel x:Name="raceCarouselAndDescription" Orientation="Horizontal" DockPanel.Dock="Top"  Grid.Row="0">
                                              <Control Template="{StaticResource subRaceSelectionTemplate}"/>
                                            </StackPanel>

                                            <Control Template="{StaticResource subRaceProgressionsTemplate}"  Grid.Row="1"/>
                                        </Grid>
                                      </DockPanel>

                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="class">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource ClassSelectorTemplate}"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="subclass">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource SubClassSelectorTemplate}"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="draconic">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource PassiveFeaturesAppearanceTemplate}"/>
                        </DataTrigger>

                        <!-- Show passiveFeaturesTab for Draconic Sorcerer -->
                        <DataTrigger Binding="{Binding SelectedSubClass.IsDraconicSorcerer}" Value="True">
                            <Setter TargetName="draconicTab" Property="Visibility" Value="Visible"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="deity">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource DeitySelectorTemplate}"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="spellprep">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource HUI_SpellPrepTemplate}"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="background">
                            <Setter TargetName="gameplayPanel" Property="Template" Value="{StaticResource BackgroundSelectorTemplate}"/>
                        </DataTrigger>

                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="feat">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <DockPanel LastChildFill="True">
                                                  <Grid>
                                                      <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="*" />
                                                      </Grid.RowDefinitions>
                                                      <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                      </Grid.ColumnDefinitions>
                                                      <b:Interaction.Triggers>
                                                          <b:EventTrigger EventName="Loaded">
                                                              <ls:SetMoveFocusAction TargetName="CharacterRespec_c"/>
                                                          </b:EventTrigger>
                                                      </b:Interaction.Triggers>

                                                    <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                      <StackPanel x:Name="featSelectionPanelTemplate" Orientation="Horizontal" VerticalAlignment="Stretch"  DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0">
                                                          <Control Template="{StaticResource featSelectionTemplate}"/>
                                                      </StackPanel>

                                                      <Control Template="{StaticResource HUI_SelectorClosingTemplate}" Grid.Column="0" Grid.Row="1"/>
                                                  </Grid>
                                                </DockPanel>

                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="featdetails">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <DockPanel LastChildFill="True">
                                                  <Grid>
                                                      <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="*" />
                                                      </Grid.RowDefinitions>
                                                      <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                      </Grid.ColumnDefinitions>
                                                      <b:Interaction.Triggers>
                                                          <b:EventTrigger EventName="Loaded">
                                                              <ls:SetMoveFocusAction TargetName="CharacterRespec_c"/>
                                                          </b:EventTrigger>
                                                      </b:Interaction.Triggers>

                                                    <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                      <StackPanel x:Name="featDetailsPanelTemplate" Orientation="Horizontal" VerticalAlignment="Stretch"  DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0">
                                                          <Control Template="{StaticResource featDetailsTemplate}"/>
                                                      </StackPanel>

                                                      <Control Template="{StaticResource HUI_SelectorClosingTemplate}" Grid.Column="0" Grid.Row="1"/>
                                                  </Grid>
                                                </DockPanel>

                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>


                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="raceskills">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <DockPanel LastChildFill="True">
                                                  <Grid>
                                                    <Grid.RowDefinitions>
                                                      <RowDefinition Height="Auto" />
                                                      <RowDefinition Height="*" />
                                                    </Grid.RowDefinitions>

                                                    <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                      <StackPanel x:Name="backgroundCarouselAndDescription" Orientation="Horizontal" VerticalAlignment="Stretch" DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0">
                                                          <Control Template="{StaticResource raceSkillProficiencyPanelTemplate}"/>
                                                      </StackPanel>
                                                    </Grid>
                                                </DockPanel>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>                                
                                
                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="skills">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <DockPanel LastChildFill="True">
                                                  <Grid>
                                                    <Grid.RowDefinitions>
                                                      <RowDefinition Height="Auto" />
                                                      <RowDefinition Height="*" />
                                                    </Grid.RowDefinitions>

                                                    <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                      <StackPanel x:Name="backgroundCarouselAndDescription" Orientation="Horizontal" VerticalAlignment="Stretch" DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0">
                                                          <Control Template="{StaticResource skillProficiencyPanelTemplate}"/>
                                                      </StackPanel>
                                                    </Grid>
                                                </DockPanel>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="expertise">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <DockPanel LastChildFill="True">
                                                  <Grid>
                                                    <Grid.RowDefinitions>
                                                      <RowDefinition Height="Auto" />
                                                      <RowDefinition Height="*" />
                                                    </Grid.RowDefinitions>
                                                    <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                    <StackPanel x:Name="backgroundCarouselAndDescription" Orientation="Horizontal" VerticalAlignment="Stretch" DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0">
                                                      <Control Template="{StaticResource skillExpertisePanelTemplate}"/>
                                                    </StackPanel>
                                                  </Grid>
                                                </DockPanel>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="ability">
                                    <Setter TargetName="gameplayPanel" Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>

                                                    <DockPanel VerticalAlignment="Top">
                                                        <b:Interaction.Triggers>
                                                            <b:EventTrigger EventName="Loaded">
                                                                <b:InvokeCommandAction Command="{Binding HideTooltipOnUIElementCommand, ElementName=CharacterRespec_c}"/>
                                                            </b:EventTrigger>
                                                        </b:Interaction.Triggers>

                                                        <Control Template="{StaticResource setGameplayCameraOffsets}"/>

                                                        <Control Template="{StaticResource abilitySelectionTemplate}"/>

                                                    </DockPanel>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>

                        <DataTrigger Binding="{Binding ElementName=gameplayTabs, Path=SelectedItem.Tag}" Value="naming">
                            <Setter TargetName="leftSideShading" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="gameplayPanel" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="namingBackground" Property="Template">
                                <Setter.Value>
                                    <ControlTemplate>
                                        <Grid>
                                            <b:Interaction.Triggers>
                                                <b:EventTrigger EventName="Loaded">
                                                    <b:InvokeCommandAction Command="{Binding HideTooltipOnUIElementCommand, ElementName=CharacterRespec_c}"/>
                                                </b:EventTrigger>
                                            </b:Interaction.Triggers>

                                            <Control Template="{StaticResource setNamingCamera}"/>

                                            <Rectangle x:Name="lowerShading" Height="800" VerticalAlignment="Bottom" HorizontalAlignment="Stretch">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1" >
                                                        <GradientStop Color="{StaticResource transparentBlack}" Offset="0"/>
                                                        <GradientStop Color="Black" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>

                                            <Grid MinWidth="1100" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,350">
                                                <Grid Background="{StaticResource CCTextSpecial}" Opacity="0.8" Height="100"/>

                                                <TextBlock x:Name="characterName" Text="{Binding CharacterName}" IsEnabled="False" Foreground="{StaticResource CCTextPrimary}"
                                                           FontSize="{StaticResource ScaledMassiveFontSize}" TextAlignment="Center" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Control.Template>
        </Control>

    </Grid>

</ls:UIWidget>